
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Customizing the User Environment &#8212; Zero to JupyterHub with Kubernetes 0.4 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="User Resources" href="user-resources.html" />
    <link rel="prev" title="Extending your JupyterHub setup" href="extending-jupyterhub.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class='prev-next-top'>
    
     <a class='left-prev' href="extending-jupyterhub.html" title="previous chapter">Previous</a>
     <a class='right-next' href="user-resources.html" title="next chapter">Next</a>
  <div style='clear:both;'></div>

  </div>

  
  <div class="section" id="customizing-the-user-environment">
<span id="user-environment"></span><h1>Customizing the User Environment<a class="headerlink" href="#customizing-the-user-environment" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For a list of all the options you can configure with your helm
chart, see the <a class="reference internal" href="reference.html#id1"><span class="std std-ref">Helm Chart Reference</span></a>.</p>
</div>
<p>This page contains instructions for a few common ways you can extend the
user experience for your kubernetes deployment.</p>
<p>The <strong>user environment</strong> is the set of packages, environment variables, and
various files that are present when the user logs into JupyterHub. The user may
also see different tools that provide interfaces to perform specialized tasks,
such as RStudio, RISE, JupyterLab, and others.</p>
<p>Usually a <a class="reference internal" href="glossary.html#term-docker-image"><span class="xref std std-term">docker image</span></a> specifies the functionality and
environment that you wish to provide to users. The following sections will describe
how to use existing docker images, how to create custom images, and how to set
environment variables.</p>
<div class="section" id="use-an-existing-docker-image">
<h2>Use an existing docker image<a class="headerlink" href="#use-an-existing-docker-image" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The Docker image you are using must have the <code class="docutils literal"><span class="pre">jupyterhub</span></code> package
installed in order to work. Moreover, the version of <code class="docutils literal"><span class="pre">jupyterhub</span></code> must
match the version installed by the helm chart that you’re using. For example,
<code class="docutils literal"><span class="pre">v0.5</span></code> of the helm chart uses  <code class="docutils literal"><span class="pre">jupyterhub==0.8</span></code>.</p>
</div>
<p>Using an existing docker image, that someone else has written and maintained,
is the simplest approach. For example, Project Jupyter maintains the
<a class="reference external" href="https://github.com/jupyter/docker-stacks/">jupyter/docker-stacks</a> repo,
which contains ready to use docker images. Each image includes a set of
commonly used science and data science libraries and tools.</p>
<p>The <a class="reference external" href="https://hub.docker.com/r/jupyter/scipy-notebook/">scipy-notebook</a>
image, which can be found in the <code class="docutils literal"><span class="pre">docker-stacks</span></code> repo, contains
<a class="reference external" href="https://github.com/jupyter/docker-stacks/tree/master/scipy-notebook">useful scientific programming libraries</a>
pre-installed. This image may satisfy your needs. If you wish to use an
existing image, such as the <code class="docutils literal"><span class="pre">scipy-notebook</span></code> image, complete these steps:</p>
<ol class="arabic">
<li><p class="first">Modify your <code class="docutils literal"><span class="pre">config.yaml</span></code> file to specify the image. For example:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">singleuser</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">jupyter/scipy-notebook</span>
    <span class="l l-Scalar l-Scalar-Plain">tag</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">c7fb6660d096</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Always use an explicit <code class="docutils literal"><span class="pre">tag</span></code>, such as a specific commit.</p>
<p class="last">Avoid using <code class="docutils literal"><span class="pre">latest</span></code>. Using <code class="docutils literal"><span class="pre">latest</span></code> might cause a several minute
delay, confusion, or failures for users when a new version of the image
is released.</p>
</div>
</li>
<li><p class="first">Apply the changes by following the directions listed in
<a class="reference external" href="extending-jupyterhub.html#apply-config-changes">apply the changes</a>. These directions will <strong>pre-pull</strong> the image to all
the nodes in your cluster. This process may take several minutes to
complete.</p>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Docker images must have the <code class="docutils literal"><span class="pre">jupyterhub</span></code> package installed within them to
be used in this manner.</p>
</div>
</div>
<div class="section" id="build-a-custom-docker-image-with-repo2docker">
<h2>Build a custom Docker image with <code class="docutils literal"><span class="pre">repo2docker</span></code><a class="headerlink" href="#build-a-custom-docker-image-with-repo2docker" title="Permalink to this headline">¶</a></h2>
<p>If you can’t find a pre-existing image that suits your needs, you can
create your own image. The easiest way to do this is with the package
<a class="reference internal" href="glossary.html#term-repo2docker"><span class="xref std std-term">repo2docker</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><a class="reference external" href="https://github.com/jupyter/repo2docker">repo2docker</a> lets you quickly
convert a GitHub repository into a Docker image that can be used as a base
for your JupyterHub instance. Anything inside the GitHub repository
will exist in a user’s environment when they join your JupyterHub:</p>
<ul class="last simple">
<li>If you include a <code class="docutils literal"><span class="pre">requirements.txt</span></code> file in the root level of the
repository, <code class="docutils literal"><span class="pre">repo2docker</span></code> will <code class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span></code> the specified packages
into the Docker image to be built.</li>
<li>If you have an <code class="docutils literal"><span class="pre">environment.yaml</span></code> file, <code class="docutils literal"><span class="pre">conda</span></code> will create an
environment based on this file’s specification.</li>
<li>If you have a <code class="docutils literal"><span class="pre">Dockerfile</span></code>, <code class="docutils literal"><span class="pre">repo2docker</span></code> will ignore everything
else and just use the Dockerfile.</li>
</ul>
</div>
<p>Below we’ll cover how to use <code class="docutils literal"><span class="pre">repo2docker</span></code> to generate a Docker image and
how to configure JupyterHub to build off of this image:</p>
<ol class="arabic">
<li><p class="first"><strong>Download and start Docker.</strong> You can do this by
<a class="reference external" href="https://store.docker.com/search?offering=community&amp;platform=desktop%2Cserver&amp;q=&amp;type=edition">downloading and installing Docker</a>. Once you’ve started Docker,
it will show up as a tiny background application.</p>
</li>
<li><p class="first"><strong>Install repo2docker</strong> using <code class="docutils literal"><span class="pre">pip</span></code>:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">jupyter</span><span class="o">-</span><span class="n">repo2docker</span>
</pre></div>
</div>
<p>If that command fails due to insufficient permissions, try it with the
command option, <code class="docutils literal"><span class="pre">user</span></code>:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">--</span><span class="n">user</span> <span class="n">jupyter</span><span class="o">-</span><span class="n">repo2docker</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Create (or find) a GitHub repository you want to use.</strong> This repo should
have all materials that you want your users to be able to use. You may want
to include a <a class="reference external" href="https://pip.readthedocs.io/en/latest/user_guide/#requirements-files">pip</a> <code class="docutils literal"><span class="pre">requirements.txt</span></code> file to list packages, one per
file line, to install such as when using <code class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span></code>. Specify the
versions explicitly so the image is fully reproducible. An example
<code class="docutils literal"><span class="pre">requirements.txt</span></code> follows:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">numpy</span><span class="o">==</span><span class="m">1</span>.12.1
<span class="nv">scipy</span><span class="o">==</span><span class="m">0</span>.19.0
<span class="nv">matplotlib</span><span class="o">==</span><span class="m">2</span>.0
</pre></div>
</div>
</li>
<li><p class="first"><strong>Use repo2docker to build a Docker image.</strong></p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>jupyter-repo2docker &lt;YOUR-GITHUB-REPOSITORY&gt; --image<span class="o">=</span>gcr.io/&lt;PROJECT-NAME&gt;/&lt;IMAGE-NAME&gt;:&lt;TAG&gt; --no-run
</pre></div>
</div>
<p>This tells <code class="docutils literal"><span class="pre">repo2docker</span></code> to fetch <code class="docutils literal"><span class="pre">master</span></code> of the GitHub repository,
and uses heuristics to build a docker image of it.</p>
</li>
</ol>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>The project name should match your google cloud project’s name.</li>
<li>Don’t use underscores in your image name. Other than this, the name can
be anything memorable. <em>This bug with underscores will be fixed soon.</em></li>
<li>The tag should be the first 6 characters of the SHA in the GitHub
commit desired for building the image since this improves
reproducibility.</li>
</ul>
</div>
</div></blockquote>
<ol class="arabic" start="5">
<li><p class="first"><strong>Push the newly-built Docker image to the cloud.</strong> You can either push
this to Docker Hub or to the gcloud docker repository. Here we’ll
demonstrate pushing to the gcloud repository:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>gcloud docker -- push gcr.io/&lt;project-name&gt;/&lt;image-name&gt;:&lt;tag&gt;
</pre></div>
</div>
</li>
<li><p class="first"><strong>Edit the JupyterHub configuration to build from this image.</strong>
Edit <code class="docutils literal"><span class="pre">config.yaml</span></code> file to include these lines in it:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>singleuser:
  image:
    name: gcr.io/&lt;project-name&gt;/&lt;image-name&gt;
    tag: &lt;tag&gt;
</pre></div>
</div>
<p>This step can be done automatically by setting a flag if desired.</p>
</li>
<li><p class="first"><strong>Tell helm to update JupyterHub to use this configuration.</strong> Use the
standard method to <a class="reference external" href="extending-jupyterhub.html#apply-config-changes">apply the changes</a> to the config.</p>
</li>
<li><p class="first"><strong>Restart your notebook if you are already logged in.</strong> If you already have
a running JupyterHub session, you’ll need to restart it (by stopping and
starting your session from the control panel in the top right). New users
won’t have to do this.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The contents of your GitHub repository might not show up if you have
enabled <a class="reference external" href="user_storage">persistent storage</a>. Disable persistent storage
if you want the
GitHub repository contents to show up.</p>
</div>
</li>
<li><p class="first"><strong>Enjoy your new computing environment!</strong> You should now have a live
computing environment built off of the Docker image we’ve created.</p>
</li>
</ol>
</div>
<div class="section" id="set-environment-variables">
<h2>Set environment variables<a class="headerlink" href="#set-environment-variables" title="Permalink to this headline">¶</a></h2>
<p>Another way to affect your user’s environment is by setting values for
<a class="reference internal" href="glossary.html#term-environment-variables"><span class="xref std std-term">environment variables</span></a>. While you can set them up in your Docker image,
it is often easier to set them up in your helm chart.</p>
<p>To set them up in your helm chart, edit your <code class="docutils literal"><span class="pre">config.yaml</span></code> file
and <a class="reference external" href="extending-jupyterhub.html#apply-config-changes">apply the changes</a>. For example, this code snippet will set the
environment variable <code class="docutils literal"><span class="pre">EDITOR</span></code> to the value <code class="docutils literal"><span class="pre">vim</span></code>:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">singleuser</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">extraEnv</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">EDITOR</span><span class="p p-Indicator">:</span> <span class="s">&quot;vim&quot;</span>
</pre></div>
</div>
<p>You can set any number of static environment variables in the <code class="docutils literal"><span class="pre">config.yaml</span></code>
file.</p>
<p>Users can read the environment variables in their code in various ways. In
Python, for example, the following code will read in an environment variable:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">my_value</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MY_ENVIRONMENT_VARIABLE&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Other languages will have their own methods of reading these environment
variables.</p>
</div>
<div class="section" id="pre-populating-user-s-home-directory-with-notebooks">
<h2>Pre-populating user’s <code class="docutils literal"><span class="pre">$HOME</span></code> directory with notebooks<a class="headerlink" href="#pre-populating-user-s-home-directory-with-notebooks" title="Permalink to this headline">¶</a></h2>
<p>By default, the contents of <code class="docutils literal"><span class="pre">$HOME</span></code> in the docker image are hidden by
the contents of the per-user persistent volume. If you want to, you can
execute a command before the notebook starts each time and copy the files
you want from your image to the user’s home directory.</p>
<p>If you were using the repo2docker method of building an image and wanted
your git repo copied on first use to the user’s home directory, you can
use the following in your <code class="docutils literal"><span class="pre">config.yaml</span></code> file:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>singleuser:
  lifecycleHooks:
    postStart:
      exec:
        command: <span class="o">[</span><span class="s2">&quot;/bin/sh&quot;</span>, <span class="s2">&quot;-c&quot;</span>, <span class="s2">&quot;test -f </span><span class="nv">$HOME</span><span class="s2">/.copied || cp -Rf /srv/app/src/. </span><span class="nv">$HOME</span><span class="s2">/; touch </span><span class="nv">$HOME</span><span class="s2">/.copied&quot;</span><span class="o">]</span>
</pre></div>
</div>
</div></blockquote>
<p>Note that this will only copy the contents of the directory to <code class="docutils literal"><span class="pre">$HOME</span></code>
<em>once</em> - the first time the user logs in. Further updates will not be
reflected. <em>There is work in progress for improving this behavior.</em></p>
</div>
</div>


  <div class='prev-next-bottom'>
    
     <a class='left-prev' href="extending-jupyterhub.html" title="previous chapter">Extending your JupyterHub setup</a>
     <a class='right-next' href="user-resources.html" title="next chapter">User Resources</a>
  <div style='clear:both;'></div>

  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="index.html">Zero to JupyterHub with Kubernetes</a></h1>



<p class="blurb">A tutorial to help install and manage JupyterHub with Kubernetes</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=jupyterhub&repo=zero-to-jupyterhub-k8s&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






<h3>Table of Contents</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting started with JupyterHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="create-k8s-cluster.html">Creating a Kubernetes Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup-helm.html">Setting up Helm</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup-jupyterhub.html">Setting up JupyterHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="turn-off.html">Turning Off JupyterHub and Computational Resources</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="extending-jupyterhub.html">Extending your JupyterHub setup</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Customizing the User Environment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#use-an-existing-docker-image">Use an existing docker image</a></li>
<li class="toctree-l2"><a class="reference internal" href="#build-a-custom-docker-image-with-repo2docker">Build a custom Docker image with <code class="docutils literal"><span class="pre">repo2docker</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#set-environment-variables">Set environment variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pre-populating-user-s-home-directory-with-notebooks">Pre-populating user’s <code class="docutils literal"><span class="pre">$HOME</span></code> directory with notebooks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="user-resources.html">User Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-management.html">User Management</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="debug.html">Debugging Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="cost.html">Estimating costs</a></li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Advanced Topics</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Helm Chart Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Tools used in a JupyterHub Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="additional-resources.html">Additional resources</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="http://github.com/jupyterhub/zero-to-jupyterhub-k8s">GitHub Repo</a></li>
    
    <li class="toctree-l1"><a href="http://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues">Issue Tracker</a></li>
    
</ul>

<div class="relations">
<h3>Navigation</h3>
<ul>
  <li><a href="index.html">Documentation Home</a><ul>
  <li><a href="extending-jupyterhub.html" title="Previous">Previous topic</a></li>
  <li><a href="user-resources.html" title="Next">Next topic</a></li>
  </ul>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/user-environment.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Project Jupyter team.
      
      |
      <a href="_sources/user-environment.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>