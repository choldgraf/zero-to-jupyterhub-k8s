
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Extending your JupyterHub setup &#8212; Zero to JupyterHub with Kubernetes 0.4 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Customization of the User Experience" href="user-experience.html" />
    <link rel="prev" title="Turning Off JupyterHub and Computational Resources" href="turn-off.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="extending-your-jupyterhub-setup">
<span id="extending-jupyterhub"></span><h1>Extending your JupyterHub setup<a class="headerlink" href="#extending-your-jupyterhub-setup" title="Permalink to this headline">¶</a></h1>
<p>The helm chart used to install JupyterHub has a lot of options for you to tweak.
This page lists some of the most common changes.</p>
<div class="section" id="applying-configuration-changes">
<span id="apply-config-changes"></span><h2>Applying configuration changes<a class="headerlink" href="#applying-configuration-changes" title="Permalink to this headline">¶</a></h2>
<p>The general method is:</p>
<ol class="arabic">
<li><p class="first">Make a change to the <code class="docutils literal"><span class="pre">config.yaml</span></code></p>
</li>
<li><p class="first">Run a helm upgrade:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>helm upgrade &lt;YOUR_RELEASE_NAME&gt; jupyterhub/jupyterhub --version<span class="o">=</span>v0.4 -f config.yaml
</pre></div>
</div>
</div></blockquote>
<p>Where <code class="docutils literal"><span class="pre">&lt;YOUR_RELEASE_NAME&gt;</span></code> is the parameter you passed to <code class="docutils literal"><span class="pre">--name</span></code> when
<a class="reference external" href="setup-jupyterhub.html#install-jupyterhub">installing jupyterhub</a> with
<code class="docutils literal"><span class="pre">helm</span> <span class="pre">install</span></code>. If you don’t remember it, you can probably find it by doing
<code class="docutils literal"><span class="pre">helm</span> <span class="pre">list</span></code>.</p>
</li>
<li><p class="first">Wait for the upgrade to finish, and make sure that when you do
<code class="docutils literal"><span class="pre">kubectl</span> <span class="pre">--namespace=&lt;YOUR_NAMESPACE&gt;</span> <span class="pre">get</span> <span class="pre">pod</span></code> the hub and proxy pods are
in <code class="docutils literal"><span class="pre">Ready</span></code> state. Your configuration change has been applied!</p>
</li>
</ol>
</div>
<div class="section" id="authenticating-with-oauth2">
<h2>Authenticating with OAuth2<a class="headerlink" href="#authenticating-with-oauth2" title="Permalink to this headline">¶</a></h2>
<p>JupyterHub’s <a class="reference external" href="https://github.com/jupyterhub/oauthenticator">oauthenticator</a>
has support for enabling your users to authenticate via a third-party OAuth
provider, including GitHub, Google, and CILogon.</p>
<p>Follow the service-specific instructions linked on the
<a class="reference external" href="https://github.com/jupyterhub/oauthenticator">oauthenticator repository</a>
to generate your JupyterHub instance’s OAuth2 client ID and client secret. Then
declare the values in the helm chart (<code class="docutils literal"><span class="pre">config.yaml</span></code>).</p>
<p>Here are example configurations for two common authentication services. Note
that in each case, you need to get the authentication credential information
before you can configure the helmchart for authentication.</p>
<p><strong>Google</strong></p>
<p>For more information see the full example of Google OAuth2 in the next section.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">auth</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">google</span>
  <span class="l l-Scalar l-Scalar-Plain">google</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">clientId</span><span class="p p-Indicator">:</span> <span class="s">&quot;yourlongclientidstring.apps.googleusercontent.com&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">clientSecret</span><span class="p p-Indicator">:</span> <span class="s">&quot;adifferentlongstring&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">callbackUrl</span><span class="p p-Indicator">:</span> <span class="s">&quot;http://&lt;your_jupyterhub_host&gt;/hub/oauth_callback&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">hostedDomain</span><span class="p p-Indicator">:</span> <span class="s">&quot;youruniversity.edu&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">loginService</span><span class="p p-Indicator">:</span> <span class="s">&quot;Your</span><span class="nv"> </span><span class="s">University&quot;</span>
</pre></div>
</div>
<p><strong>GitHub</strong></p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">auth</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">github</span>
  <span class="l l-Scalar l-Scalar-Plain">github</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">clientId</span><span class="p p-Indicator">:</span> <span class="s">&quot;y0urg1thubc1ient1d&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">clientSecret</span><span class="p p-Indicator">:</span> <span class="s">&quot;an0ther1ongs3cretstr1ng&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">callbackUrl</span><span class="p p-Indicator">:</span> <span class="s">&quot;http://&lt;your_jupyterhub_host&gt;/hub/oauth_callback&quot;</span>
</pre></div>
</div>
<p>To add a whitelist of usernames add to the config file under <cite>hub</cite>:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">hub</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">extraConfig</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
        <span class="no">c.Authenticator.whitelist = {&quot;user1&quot;, &quot;user2&quot;}</span>
</pre></div>
</div>
</div>
<div class="section" id="full-example-of-google-oauth2">
<h2>Full Example of Google OAuth2<a class="headerlink" href="#full-example-of-google-oauth2" title="Permalink to this headline">¶</a></h2>
<p>If your institution is a <a class="reference external" href="https://gsuite.google.com">G Suite customer</a> that
integrates with Google services such as Gmail, Calendar, and Drive, you can
authenticate users to your JupyterHub using Google for authentication.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Google requires that you specify a fully qualified domain name for your
hub rather than an IP address.</p>
</div>
<ol class="arabic simple">
<li>Log in to the <a class="reference external" href="https://console.developers.google.com">Google API Console</a>.</li>
<li>Select a project &gt; Create a project… and set ‘Project name’. This is a
short term that is only displayed in the console. If you have already
created a project you may skip this step.</li>
<li>Type “Credentials” in the search field at the top and click to access the
Credentials API.</li>
<li>Click “Create credentials”, then “OAuth client ID”. Choose
“Application type” &gt; “Web application”.</li>
<li>Enter a name for your JupyterHub instance. You can give it a descriptive
name or set it to be the hub’s hostname.</li>
<li>Set “Authorized JavaScript origins” to be your hub’s URL.</li>
<li>Set “Authorized redirect URIs” to be your hub’s URL followed by
“/hub/oauth_callback”. For example, <a class="reference external" href="http://example.com/hub/oauth_callback">http://example.com/hub/oauth_callback</a>.</li>
<li>When you click “Create”, the console will generate and display a Client ID
and Client Secret. Save these values.</li>
<li>Type “consent screen” in the search field at the top and click to access the
OAuth consent screen. Here you will customize what your users see when they
login to your JupyterHub instance for the first time. Click Save when you
are done.</li>
<li>In your helm chart, create a stanza that contains these OAuth fields:</li>
</ol>
<div class="highlight-bash"><div class="highlight"><pre><span></span>auth:
  type: google
  google:
    clientId: <span class="s2">&quot;yourlongclientidstring.apps.googleusercontent.com&quot;</span>
    clientSecret: <span class="s2">&quot;adifferentlongstring&quot;</span>
    callbackUrl: <span class="s2">&quot;http://&lt;your_jupyterhub_host&gt;/hub/oauth_callback&quot;</span>
    hostedDomain: <span class="s2">&quot;youruniversity.edu&quot;</span>
    loginService: <span class="s2">&quot;Your University&quot;</span>
</pre></div>
</div>
<p>The ‘callbackUrl’ key is set to the authorized redirect URI you specified
earlier. Set ‘hostedDomain’ to your institution’s domain name. The value of
‘loginService’ is a descriptive term for your institution that reminds your
users which account they are using to login.</p>
</div>
<div class="section" id="expanding-and-contracting-the-size-of-your-cluster">
<h2>Expanding and contracting the size of your cluster<a class="headerlink" href="#expanding-and-contracting-the-size-of-your-cluster" title="Permalink to this headline">¶</a></h2>
<p>You can easily scale up or down your cluster’s size to meet usage demand or to
save cost when the cluster is not being used. Use the <code class="docutils literal"><span class="pre">resize</span></code> command and
provide a new cluster size (i.e. number of nodes) as a command line option
<code class="docutils literal"><span class="pre">--size</span></code>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>gcloud container clusters resize <span class="se">\</span>
             &lt;YOUR-CLUSTER-NAME&gt; <span class="se">\</span>
             --size &lt;NEW-SIZE&gt; <span class="se">\</span>
             --zone &lt;YOUR-CLUSTER-ZONE&gt;
</pre></div>
</div>
<p>To display the cluster’s name, zone, or current size, use the command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>gcloud container clusters list
</pre></div>
</div>
<p>After resizing the cluster, it may take a couple of minutes for the new cluster
size to be reported back as the service is adding or removing nodes. You can
find the true count of currently ‘ready’ nodes using <code class="docutils literal"><span class="pre">kubectl</span> <span class="pre">get</span> <span class="pre">node</span></code> to
report the current <code class="docutils literal"><span class="pre">Ready/NotReady</span></code> status of all nodes in the cluster.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>When organizing and running a workshop, resizing a cluster gives you a way
to save cost and prepare JupyterHub before the event. For example:</p>
<ul class="last simple">
<li><strong>One week before the workshop:</strong> You can create the cluster, set
everything up, and then resize the cluster to zero nodes to save cost.</li>
<li><strong>On the day of the workshop:</strong> You can scale the cluster up to a suitable
size for the workshop. This workflow also helps you avoid scrambling on
the workshop day to set up the cluster and JupyterHub.</li>
<li><strong>After the workshop:</strong> The cluster can be deleted.</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Extending your JupyterHub setup</a><ul>
<li><a class="reference internal" href="#applying-configuration-changes">Applying configuration changes</a></li>
<li><a class="reference internal" href="#authenticating-with-oauth2">Authenticating with OAuth2</a></li>
<li><a class="reference internal" href="#full-example-of-google-oauth2">Full Example of Google OAuth2</a></li>
<li><a class="reference internal" href="#expanding-and-contracting-the-size-of-your-cluster">Expanding and contracting the size of your cluster</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="turn-off.html" title="previous chapter">Turning Off JupyterHub and Computational Resources</a></li>
      <li>Next: <a href="user-experience.html" title="next chapter">Customization of the User Experience</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/extending-jupyterhub.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Project Jupyter team.
      
      |
      <a href="_sources/extending-jupyterhub.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>