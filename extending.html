<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Extending your JupyterHub setup &#8212; Zero to JupyterHub with Kubernetes 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tools for setting up JupyterHub" href="tools.html" />
    <link rel="prev" title="Step by Step Instructions" href="setup.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="extending-your-jupyterhub-setup">
<h1>Extending your JupyterHub setup<a class="headerlink" href="#extending-your-jupyterhub-setup" title="Permalink to this headline">¶</a></h1>
<p>This section describes how you can extend your JupyterHub setup beyond the
vanilla configuration. For example, you can expand the hardware requested,
such as memory and cpu limits. You can also use different base docker
images or authenticators to tailor your deployment to your needs.</p>
<div class="section" id="scaling-your-deployment-for-more-users">
<h2>Scaling your deployment for more users<a class="headerlink" href="#scaling-your-deployment-for-more-users" title="Permalink to this headline">¶</a></h2>
<p>Currently, we don&#8217;t have a way to automatically scale the number of resources that
are being used according to the number of active users. This means that you should
request a number of nodes that can service all of your potential users at once.
This is done in the initial call to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">gcloud</span> <span class="n">container</span> <span class="n">clusters</span> <span class="n">create</span>
</pre></div>
</div>
<p>A good rule of thumb is to put { TODO } users per node.</p>
</div>
<div class="section" id="extending-the-helm-configuration">
<h2>Extending the helm configuration<a class="headerlink" href="#extending-the-helm-configuration" title="Permalink to this headline">¶</a></h2>
<p>Since the helmchart tells kubernetes what kind of resources to make available,
we can use the helmchart to determine what kind of computing environment users
will experience. We do this by editing the <code class="docutils literal"><span class="pre">config.yaml</span></code> file that the
helmchart uses to build. For a list of configuration options that are possible,
see the link below:</p>
<p><a class="reference external" href="https://github.com/jupyterhub/helm-chart/blob/master/jupyterhub/values.yaml">https://github.com/jupyterhub/helm-chart/blob/master/jupyterhub/values.yaml</a></p>
</div>
<div class="section" id="using-an-existing-image">
<h2>Using an existing image<a class="headerlink" href="#using-an-existing-image" title="Permalink to this headline">¶</a></h2>
<p>It&#8217;s possible to build your jupyterhub deployment off of a pre-existing Docker image.
To do this, you need to find an existing image somewhere (such as DockerHub), and configure
your installation to use it.</p>
<p>For example, UC Berkeley&#8217;s <a class="reference external" href="https://hub.docker.com/r/berkeleydsep/singleuser-data8">Data8 Program</a> publishes the image they are using on Dockerhub.
To instruct JupyterHub to use this image, simply add this to your <code class="docutils literal"><span class="pre">config.yaml</span></code> file:</p>
<blockquote>
<div><div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">singleuser</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span>
       <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">berkeleydsep/singleuser-data8</span>
       <span class="l l-Scalar l-Scalar-Plain">tag</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v0.1</span>
</pre></div>
</div>
</div></blockquote>
<p>If you have alreday initialized jupyterhub with the helmchart, you&#8217;ll need to &#8220;upgrade&#8221; your helmchart.
This will instruct the cluster to re-implement the instructions in <code class="docutils literal"><span class="pre">config.yaml</span></code> (which in this case
now points to the Docker Hub image).</p>
<p>To upgrade the cluster, run:</p>
<blockquote>
<div><div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">helm</span> <span class="n">upgrade</span> <span class="o">&lt;</span><span class="n">YOUR_RELEASE_NAME</span><span class="o">&gt;</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">jupyterhub</span><span class="o">/</span><span class="n">helm</span><span class="o">-</span><span class="n">chart</span><span class="o">/</span><span class="n">releases</span><span class="o">/</span><span class="n">download</span><span class="o">/</span><span class="n">v0</span><span class="o">.</span><span class="mi">1</span><span class="o">/</span><span class="n">jupyterhub</span><span class="o">-</span><span class="mf">0.1</span><span class="o">.</span><span class="n">tgz</span> <span class="o">-</span><span class="n">f</span> <span class="n">config</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">&lt;YOUR_RELEASE_NAME&gt;</span></code> is what you provided to <code class="docutils literal"><span class="pre">--name</span></code> when you did the initial <cite>helm install</cite>.
If you forgot what name you used, you might be able to find out by running <code class="docutils literal"><span class="pre">helm</span> <span class="pre">list</span></code>.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="extending-your-software-stack-with-s2i">
<h2>Extending your software stack with s2i<a class="headerlink" href="#extending-your-software-stack-with-s2i" title="Permalink to this headline">¶</a></h2>
<p>s2i, also known as <a class="reference external" href="https://github.com/openshift/source-to-image">Source to Image</a>, lets you
quickly convert a GitHub repository into a Docker image that we can use as a
base for your JupyterHub instance. Anything inside the GitHub repository
will exist in a user’s environment when they join your JupyterHub. If you
include a <code class="docutils literal"><span class="pre">requirements.txt</span></code> file in the root level of your of the repository,
s2i will <code class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span></code> each of these packages into the Docker image to be
built. Below we’ll cover how to use s2i to generate a Docker image and how to
configure JupyterHub to build off of this image.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For this section, you’ll need to install s2i and docker.</p>
</div>
<ol class="arabic">
<li><p class="first"><strong>Download s2i.</strong> This is easily done with homebrew on a mac. For linux and
Windows it entails a couple of quick commands that you can find in the
links below:</p>
<blockquote>
<div><ul class="simple">
<li>On OSX: <code class="docutils literal"><span class="pre">brew</span> <span class="pre">install</span> <span class="pre">s2i</span></code></li>
<li>On Linux and Windows: <a class="reference external" href="https://github.com/openshift/source-to-image#installation">follow these instructions</a></li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><strong>Download and start Docker.</strong> You can do this by downloading and installing
Docker at <a class="reference external" href="https://store.docker.com/search?offering=community&amp;platform=desktop%2Cserver&amp;q=&amp;type=edition">this link</a>.
Once you’ve started Docker, it will show up as a tiny background application.</p>
</li>
<li><p class="first"><strong>Create (or find) a GitHub repository you want to use.</strong> This repo should
have all materials that you want your users to access. In addition you can
include a <code class="docutils literal"><span class="pre">requirements.txt</span></code> file that has one package per line. These
packages should be listed in the same way that you’d install them using
<code class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span></code>. E.g.:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>numpy
scipy
<span class="nv">matplotlib</span><span class="o">=</span><span class="m">2</span>.0
</pre></div>
</div>
</li>
<li><p class="first"><strong>Use s2i to build your Docker image.</strong> <cite>s2i</cite> uses a template in order to
know how to create the Docker image. We have provided one at the url in the
commands below. Run this command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">s2i</span> <span class="n">build</span> <span class="o">&lt;</span><span class="n">git</span><span class="o">-</span><span class="n">repo</span><span class="o">-</span><span class="n">url</span><span class="o">&gt;</span>  <span class="n">yuvipanda</span><span class="o">/</span><span class="n">ubuntu1610</span><span class="o">-</span><span class="n">python35</span><span class="o">-</span><span class="n">venv</span><span class="p">:</span><span class="n">v0</span><span class="o">.</span><span class="mi">1</span> <span class="n">gcr</span><span class="o">.</span><span class="n">io</span><span class="o">/&lt;</span><span class="n">project</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;/&lt;</span><span class="n">name</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">image</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">tag</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>this effectively says <em>s2i, build `&lt;this repository&gt;` to a Docker image by
using `&lt;this template&gt;` and call the image `&lt;this&gt;`</em></p>
</li>
</ol>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>The project name should match your google cloud project&#8217;s name.</li>
<li>Don’t use underscores in your image name. Other than this it can be
anything memorable. This is a bug that will be fixed soon.</li>
<li>The tag should be the first 6 characters of the SHA in the GitHub
commit for the image to build from.</li>
</ul>
</div>
</div></blockquote>
<ol class="arabic" start="5">
<li><p class="first"><strong>Push our newly-built Docker image to the cloud.</strong> You can either push this
to Docker Hub, or to the gcloud docker repository. Here we’ll push to the
gcloud repository:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">gcloud</span> <span class="n">docker</span> <span class="o">--</span> <span class="n">push</span> <span class="n">gcr</span><span class="o">.</span><span class="n">io</span><span class="o">/&lt;</span><span class="n">project</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;/&lt;</span><span class="n">image</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">tag</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Edit the JupyterHub configuration to build from this image.</strong> We do this by editing the <code class="docutils literal"><span class="pre">config.yaml</span></code> file that we originally created to include the jupyter hashes. Edit <code class="docutils literal"><span class="pre">config.yaml</span></code> by including these lines in it:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>singleuser:
  image:
    name: gcr.io/&lt;project-name&gt;/&lt;image-name&gt;
   tag: &lt;tag&gt;
</pre></div>
</div>
</li>
<li><p class="first"><strong>Tell helm to update itself using this configuration.</strong> This makes helm
instruct kubernetes to change the way that it builds your computing
environment, which is now being pointed to the Docker image we’ve created:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">helm</span> <span class="n">upgrade</span> <span class="n">jhub</span> <span class="n">helm</span><span class="o">-</span><span class="n">chart</span> <span class="o">-</span><span class="n">f</span> <span class="n">config</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Log back into your JupyterHub instance.</strong> If you already have a running JupyterHub session, you’ll need to restart it (by restarting your session from the control panel in the top right). New users won’t have to do this.</p>
</li>
<li><p class="first"><strong>Enjoy your new computing environment!</strong> You should now have a live computing environment built off of the Docker image we’ve created.</p>
</li>
</ol>
</div>
<div class="section" id="authenticating-with-oauth2">
<h2>Authenticating with OAuth2<a class="headerlink" href="#authenticating-with-oauth2" title="Permalink to this headline">¶</a></h2>
<p>JupyterHub&#8217;s <a class="reference external" href="https://github.com/jupyterhub/oauthenticator">oauthenticator</a> has support for enabling your users to authenticate via a third-party OAuth provider, including GitHub, Google, and CILogon.</p>
<p>Follow the service-specific instructions linked on the <a class="reference external" href="https://github.com/jupyterhub/oauthenticator">oauthenticator repository</a> to generate your JupyterHub instance&#8217;s OAuth2 client ID and client secret. Then declare the values in the helm chart (<code class="docutils literal"><span class="pre">config.yaml</span></code>).</p>
<p>Here are example configurations for two common authentication services. Note that
in each case, you need to get the authentication credential information before
you can configure the helmchart for authentication.</p>
<p><strong>Google</strong></p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>auth:
  type: google
  google:
    clientId: <span class="s2">&quot;yourlongclientidstring.apps.googleusercontent.com&quot;</span>
    clientSecret: <span class="s2">&quot;adifferentlongstring&quot;</span>
    callbackUrl: <span class="s2">&quot;http://&lt;your_jupyterhub_host&gt;/hub/oauth_callback&quot;</span>
    hostedDomain: <span class="s2">&quot;youruniversity.edu&quot;</span>
    loginService: <span class="s2">&quot;Your University&quot;</span>
</pre></div>
</div>
<p><strong>GitHub</strong></p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>auth:
  type: github
  github:
    clientId: <span class="s2">&quot;y0urg1thubc1ient1d&quot;</span>
    clientSecret: <span class="s2">&quot;an0ther1ongs3cretstr1ng&quot;</span>
    callbackUrl: <span class="s2">&quot;http://&lt;your_jupyterhub_host&gt;/hub/oauth_callback&quot;</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Extending your JupyterHub setup</a><ul>
<li><a class="reference internal" href="#scaling-your-deployment-for-more-users">Scaling your deployment for more users</a></li>
<li><a class="reference internal" href="#extending-the-helm-configuration">Extending the helm configuration</a></li>
<li><a class="reference internal" href="#using-an-existing-image">Using an existing image</a></li>
<li><a class="reference internal" href="#extending-your-software-stack-with-s2i">Extending your software stack with s2i</a></li>
<li><a class="reference internal" href="#authenticating-with-oauth2">Authenticating with OAuth2</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="setup.html" title="previous chapter">Step by Step Instructions</a></li>
      <li>Next: <a href="tools.html" title="next chapter">Tools for setting up JupyterHub</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/extending.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Project Jupyter team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="_sources/extending.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>