
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Advanced Topics &#8212; Zero to JupyterHub with Kubernetes 0.4 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Helm Chart Configuration Reference" href="reference.html" />
    <link rel="prev" title="Troubleshooting" href="troubleshooting.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class='prev-next-top'>
    
     <a class='left-prev' href="troubleshooting.html" title="previous chapter">Previous</a>
     <a class='right-next' href="reference.html" title="next chapter">Next</a>
  <div style='clear:both;'></div>

  </div>

  
  <div class="section" id="advanced-topics">
<span id="advanced-topics"></span><h1>Advanced Topics<a class="headerlink" href="#advanced-topics" title="Permalink to this headline">¶</a></h1>
<p>This page contains a grab bag of various useful topics that don't have an easy
home elsewhere. Most people setting up JupyterHubs on popular public clouds
should not have to use any of this information, but it is essential for more
complex installations.</p>
<div class="section" id="ingress">
<span id="ingress"></span><h2>Ingress<a class="headerlink" href="#ingress" title="Permalink to this headline">¶</a></h2>
<p>If you are using a Kubernetes Cluster that does not provide public IPs for
services directly, you need to use
an <a class="reference external" href="https://kubernetes.io/docs/concepts/services-networking/ingress/">ingress</a>
to get traffic into your JupyterHub. This varies wildly
based on how your cluster was set up, which is why this is in the 'Advanced' section.</p>
<p>You can enable the required <code class="docutils literal"><span class="pre">ingress</span></code> object with the following in your
<code class="docutils literal"><span class="pre">config.yaml</span></code></p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">ingress</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">enabled</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span>
     <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">&lt;hostname&gt;</span>
</pre></div>
</div>
<p>You can specify multiple hosts that should be routed to the hub by listing them
under <code class="docutils literal"><span class="pre">ingress.hosts</span></code>.</p>
<p>Note that you need to install and configure an
<a class="reference external" href="https://kubernetes.io/docs/concepts/services-networking/ingress/#ingress-controllers">Ingress Controller</a>
for the ingress object to work. We recommend the
<a class="reference external" href="https://github.com/kubernetes/charts/tree/master/stable/nginx-ingress">nginx ingress</a>
controller maintained by the community.</p>
<div class="section" id="automatic-https-with-kube-lego-let-s-encrypt">
<span id="automatic-https-with-kube-lego-let-s-encrypt"></span><h3>Automatic HTTPS with kube-lego &amp; Let's Encrypt<a class="headerlink" href="#automatic-https-with-kube-lego-let-s-encrypt" title="Permalink to this headline">¶</a></h3>
<p>The default automatic HTTPS support does not work if you are using an ingress
object. You'd have to set it up yourself.</p>
<p>This uses <a class="reference external" href="https://github.com/jetstack/kube-lego">kube-lego</a> to automatically
fetch and renew HTTPS certificates
from <a class="reference external" href="https://letsencrypt.org/">Let's Encrypt</a>. This currently only works with
the nginx ingress controller &amp; google cloud's ingress controller.</p>
<ol>
<li><p class="first">Make sure that DNS is properly set up (varies wildly depending on the ingress
controller you are using and how your cluster was set up). Accessing
<code class="docutils literal"><span class="pre">&lt;hostname&gt;</span></code> from a browser should route traffic to the hub.</p>
</li>
<li><p class="first">Install &amp; configure kube-lego using the
<a class="reference external" href="https://github.com/kubernetes/charts/tree/master/stable/kube-lego">kube-lego helm-chart</a>.
Remember to change <code class="docutils literal"><span class="pre">config.LEGO_EMAIL</span></code> and <code class="docutils literal"><span class="pre">config.LEGO_URL</span></code> at the least.</p>
</li>
<li><p class="first">Add an annotation + TLS config to the ingress so kube-lego knows to get certificates for
it:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">ingress</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">annotations</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">kubernetes.io/tls-acme</span><span class="p p-Indicator">:</span> <span class="s">&quot;true&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">tls</span><span class="p p-Indicator">:</span>
   <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">&lt;hostname&gt;</span>
     <span class="l l-Scalar l-Scalar-Plain">secretName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">kubelego-tls-jupyterhub</span>
</pre></div>
</div>
</li>
</ol>
<p>This should provision a certificate, and keep renewing it whenever it gets close
to expiry!</p>
</div>
</div>
<div class="section" id="arbitrary-code-in-jupyterhub-config-py">
<span id="arbitrary-code-in-jupyterhub-config-py"></span><h2>Arbitrary code in <code class="docutils literal"><span class="pre">jupyterhub_config.py</span></code><a class="headerlink" href="#arbitrary-code-in-jupyterhub-config-py" title="Permalink to this headline">¶</a></h2>
<p>Sometimes the various options exposed via the helm-chart's <code class="docutils literal"><span class="pre">values.yaml</span></code> is not
enough, and you need to insert arbitrary extra code / config into
<code class="docutils literal"><span class="pre">jupyterhub_config.py</span></code>. This is a valuable escape hatch for both prototyping new
features that are not yet present in the helm-chart, and also for
installation-specific customization that is not suited for upstreaming.</p>
<p>There are four properties you can set in your <code class="docutils literal"><span class="pre">config.yaml</span></code> to do this.</p>
<div class="section" id="hub-extraconfig">
<span id="hub-extraconfig"></span><h3><code class="docutils literal"><span class="pre">hub.extraConfig</span></code><a class="headerlink" href="#hub-extraconfig" title="Permalink to this headline">¶</a></h3>
<p>The value specified for <code class="docutils literal"><span class="pre">hub.extraConfig</span></code> is evaluated as python code at the end
of <code class="docutils literal"><span class="pre">jupyterhub_config.py</span></code>. You can do anything here since it is arbitrary Python
Code. Some examples of things you can do:</p>
<ol class="simple">
<li>Override various methods in the Spawner / Authenticator by subclassing them.
For example, you can use this to pass authentication credentials for the user
(such as GitHub OAuth tokens) to the environment. See
<a class="reference external" href="http://jupyterhub.readthedocs.io/en/latest/reference/authenticators.html#authentication-state">the JupyterHub docs</a> for
an example.</li>
<li>Specify traitlets that take callables as values, allowing dynamic per-user
configuration.</li>
<li>Set traitlets for JupyterHub / Spawner / Authenticator that are not currently
supported in the helm chart</li>
</ol>
<p>Unfortunately, you have to write your python <em>in</em> your YAML file. There's no way
to include a file in <code class="docutils literal"><span class="pre">config.yaml</span></code>. Remember to use a <code class="docutils literal"><span class="pre">|</span></code> for multi-line strings
in YAML:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">hub</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">extraConfig</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
    <span class="no">import time</span>
    <span class="no">c.Spawner.environment += {</span>
       <span class="no">&quot;CURRENT_TIME&quot;: str(time.time())</span>
    <span class="no">}</span>
</pre></div>
</div>
</div>
<div class="section" id="hub-extraconfigmap">
<span id="hub-extraconfigmap"></span><h3><code class="docutils literal"><span class="pre">hub.extraConfigMap</span></code><a class="headerlink" href="#hub-extraconfigmap" title="Permalink to this headline">¶</a></h3>
<p>This property takes a dictionary of values that are then made available for code
in <code class="docutils literal"><span class="pre">hub.extraConfig</span></code> to read using a <code class="docutils literal"><span class="pre">get_config</span></code> function. You can use this to
easily separate your code (which goes in <code class="docutils literal"><span class="pre">hub.extraConfig</span></code>) from your config
(which should go here).</p>
<p>For example, if you use the following snippet in your config.yaml file:</p>
<div class="highlight-config.yaml"><div class="highlight"><pre><span></span>hub:
  extraConfigMap:
    myString: Hello!
    myList:
      - Item1
      - Item2
    myDict:
      key: value
    myLongString: |
      Line1
      Line2
</pre></div>
</div>
<p>In your <code class="docutils literal"><span class="pre">hub.extraConfig</span></code>,</p>
<ol class="simple">
<li><code class="docutils literal"><span class="pre">get_config('custom.myString')</span></code> will return a string <code class="docutils literal"><span class="pre">&quot;Hello!&quot;</span></code></li>
<li><code class="docutils literal"><span class="pre">get_config('custom.myList')</span></code> will return a list <code class="docutils literal"><span class="pre">[&quot;Item1&quot;,</span> <span class="pre">&quot;Item2&quot;]</span></code></li>
<li><code class="docutils literal"><span class="pre">get_config('custom.myDict')</span></code> will return a dict <code class="docutils literal"><span class="pre">{&quot;key&quot;:</span> <span class="pre">&quot;value&quot;}</span></code></li>
<li><code class="docutils literal"><span class="pre">get_config('custom.myLongString')</span></code> will return a string <code class="docutils literal"><span class="pre">&quot;Line1\nLine2&quot;</span></code></li>
<li><code class="docutils literal"><span class="pre">get_config('custom.nonExistent')</span></code> will return <code class="docutils literal"><span class="pre">None</span></code> (since you didn't
specify any value for <code class="docutils literal"><span class="pre">nonExistent</span></code>)</li>
<li><code class="docutils literal"><span class="pre">get_config('custom.myDefault',</span> <span class="pre">True)</span></code> will return <code class="docutils literal"><span class="pre">True</span></code>, since that is
specified as the second parameter (default)</li>
</ol>
<p>Note that the keys in <code class="docutils literal"><span class="pre">hub.extraConfigMap</span></code> must be alpha numeric strings
starting with a character. Dashes and Underscores are not allowed.</p>
</div>
<div class="section" id="hub-extraenv">
<span id="hub-extraenv"></span><h3><code class="docutils literal"><span class="pre">hub.extraEnv</span></code><a class="headerlink" href="#hub-extraenv" title="Permalink to this headline">¶</a></h3>
<p>This property takes a dictionary that is set as environment variables in the hub
container. You can use this to either pass in additional config to code in your
<code class="docutils literal"><span class="pre">hub.extraConfig</span></code> or set some hub parameters that are not settable by other means.</p>
</div>
<div class="section" id="hub-extracontainers">
<span id="hub-extracontainers"></span><h3><code class="docutils literal"><span class="pre">hub.extraContainers</span></code><a class="headerlink" href="#hub-extracontainers" title="Permalink to this headline">¶</a></h3>
<p>A list of extra containers that are bundled alongside the hub container in the
same pod. This is a
<a class="reference external" href="http://blog.kubernetes.io/2015/06/the-distributed-system-toolkit-patterns.html">common pattern</a> in
kubernetes that as a long list of cool use cases. Some example use cases are:</p>
<ol class="simple">
<li>Database Proxies, which are sometimes required for the hub to talk to its
configured database
(in <a class="reference external" href="https://cloud.google.com/sql/docs/mysql/sql-proxy">Google Cloud</a>) for example</li>
<li>Servers / other daemons that are used by code in your <code class="docutils literal"><span class="pre">hub.customConfig</span></code></li>
</ol>
<p>The items in this list must be valid kubernetes
<a class="reference external" href="https://kubernetes.io/docs/api-reference/v1.8/#container-v1-core">container specifications</a>.</p>
</div>
</div>
</div>


  <div class='prev-next-bottom'>
    
     <a class='left-prev' href="troubleshooting.html" title="previous chapter">Troubleshooting</a>
     <a class='right-next' href="reference.html" title="next chapter">Helm Chart Configuration Reference</a>
  <div style='clear:both;'></div>

  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="index.html">Zero to JupyterHub with Kubernetes</a></h1>



<p class="blurb">A tutorial to help install and manage JupyterHub with Kubernetes</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=jupyterhub&repo=zero-to-jupyterhub-k8s&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






<h3>Table of Contents</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting started with JupyterHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="create-k8s-cluster.html">Creating a Kubernetes Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup-helm.html">Setting up Helm</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup-jupyterhub.html">Setting up JupyterHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="turn-off.html">Turning Off JupyterHub and Computational Resources</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="extending-jupyterhub.html">Extending your JupyterHub setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-environment.html">Customizing the User Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-resources.html">User Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-management.html">User Management</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="debug.html">Debugging Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="cost.html">Estimating costs</a></li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Advanced Topics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#ingress">Ingress</a></li>
<li class="toctree-l2"><a class="reference internal" href="#arbitrary-code-in-jupyterhub-config-py">Arbitrary code in <code class="docutils literal"><span class="pre">jupyterhub_config.py</span></code></a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Helm Chart Configuration Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Tools used in a JupyterHub Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="additional-resources.html">Additional resources</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="http://github.com/jupyterhub/zero-to-jupyterhub-k8s">GitHub Repo</a></li>
    
    <li class="toctree-l1"><a href="http://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues">Issue Tracker</a></li>
    
</ul>

<div class="relations">
<h3>Navigation</h3>
<ul>
  <li><a href="index.html">Documentation Home</a><ul>
  <li><a href="troubleshooting.html" title="Previous">Previous topic</a></li>
  <li><a href="reference.html" title="Next">Next topic</a></li>
  </ul>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/advanced.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Project Jupyter team.
      
      |
      <a href="_sources/advanced.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>