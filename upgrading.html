
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Upgrading your JupyterHub Kubernetes deployment &#8212; Zero to JupyterHub with Kubernetes 0.4 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <script type="text/javascript" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/custom.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@1/dist/clipboard.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="FAQ" href="troubleshooting.html" />
    <link rel="prev" title="Security" href="security.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class='prev-next-top'>
    
     <a class='left-prev' href="security.html" title="previous chapter">Previous</a>
     <a class='right-next' href="troubleshooting.html" title="next chapter">Next</a>
  <div style='clear:both;'></div>

  </div>

  
  <div class="section" id="upgrading-your-jupyterhub-kubernetes-deployment">
<span id="upgrading-your-jupyterhub-kubernetes-deployment"></span><h1>Upgrading your JupyterHub Kubernetes deployment<a class="headerlink" href="#upgrading-your-jupyterhub-kubernetes-deployment" title="Permalink to this headline">¶</a></h1>
<p>This page covers best-practices in upgrading your JupyterHub deployment via updates
to the Helm Chart.</p>
<p>Upgrading from one version of the Helm Chart to the
next should be as seamless as possible, and generally shouldn’t require major
changes to your deployment. Check the <a class="reference external" href="https://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/master/CHANGELOG.md">CHANGELOG</a>
for each release to find out if there are any breaking changes in the newest version.</p>
<p>For additional help, feel free to reach out to us on <a class="reference external" href="http://gitter.im/jupyterhub/jupyterhub">gitter</a>
or the <a class="reference external" href="https://groups.google.com/forum/#!forum/jupyter">mailing list</a>!</p>
<div class="section" id="major-helm-chart-upgrades">
<span id="major-helm-chart-upgrades"></span><h2>Major helm-chart upgrades<a class="headerlink" href="#major-helm-chart-upgrades" title="Permalink to this headline">¶</a></h2>
<p>These steps are <strong>critical</strong> before performing a major upgrade.</p>
<ol class="simple">
<li>Always backup your database!</li>
<li>Review the <a class="reference external" href="https://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/master/CHANGELOG.md">CHANGELOG</a> for incompatible changes and upgrade instructions.</li>
<li>Update your configuration accordingly.</li>
<li>User servers may need be stopped prior to the upgrade,
or restarted after it.</li>
<li>If you are planning an upgrade of a critical major installation,
we recommend you test the upgrade out on a staging cluster first
before applying it to production.</li>
</ol>
<div class="section" id="v0-5-to-v0-6">
<span id="v0-5-to-v0-6"></span><h3>v0.5 to v0.6<a class="headerlink" href="#v0-5-to-v0-6" title="Permalink to this headline">¶</a></h3>
<p>See the <a class="reference external" href="https://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/master/CHANGELOG.md#06---ellyse-perry---2017-01-29">CHANGELOG</a>.</p>
</div>
<div class="section" id="v0-4-to-v0-5">
<span id="v0-4-to-v0-5"></span><h3>v0.4 to v0.5<a class="headerlink" href="#v0-4-to-v0-5" title="Permalink to this headline">¶</a></h3>
<p>Release 0.5 contains a major JupyterHub version bump (from 0.7.2 to 0.8).
Since it is a major upgrade of JupyterHub that changes how authentication is
implemented, user servers must be stopped during the upgrade.
The database schema has also changed, so a database upgrade must be performed.</p>
<p>See the <a class="reference external" href="https://zero-to-jupyterhub.readthedocs.io/en/v0.5-doc/upgrading.html">documentation for v0.5 for the upgrade process</a>
as well as the <a class="reference external" href="https://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/master/CHANGELOG.md#05---hamid-hassan---2017-12-05">CHANGELOG</a>
for this release for more information about changes.</p>
</div>
</div>
<div class="section" id="subtopics">
<span id="subtopics"></span><h2>Subtopics<a class="headerlink" href="#subtopics" title="Permalink to this headline">¶</a></h2>
<p>This section covers upgrade information specific to the following:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">helm</span> <span class="pre">upgrade</span></code> command</li>
<li>Databases</li>
<li>RBAC (Role Based Access Control)</li>
<li>Custom Docker images</li>
</ul>
<div class="section" id="helm-upgrade-command">
<span id="helm-upgrade-command"></span><h3><code class="docutils literal notranslate"><span class="pre">helm</span> <span class="pre">upgrade</span></code> command<a class="headerlink" href="#helm-upgrade-command" title="Permalink to this headline">¶</a></h3>
<p>After modifying your <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> file according to the CHANGELOG, you will need
<code class="docutils literal notranslate"><span class="pre">&lt;YOUR-HELM-RELEASE-NAME&gt;</span></code> to run the upgrade commands. To find <code class="docutils literal notranslate"><span class="pre">&lt;YOUR-RELEASE-NAME&gt;</span></code>, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">helm</span> <span class="nb">list</span>
</pre></div>
</div>
<p>Make sure to test the upgrade on a staging environment before doing the upgrade on
a production system!</p>
<p>To run the upgrade:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">helm</span> <span class="n">upgrade</span> <span class="o">&lt;</span><span class="n">YOUR</span><span class="o">-</span><span class="n">HELM</span><span class="o">-</span><span class="n">RELEASE</span><span class="o">-</span><span class="n">NAME</span><span class="o">&gt;</span> <span class="n">jupyterhub</span><span class="o">/</span><span class="n">jupyterhub</span> <span class="o">--</span><span class="n">version</span><span class="o">=&lt;</span><span class="n">RELEASE</span><span class="o">-</span><span class="n">VERSION</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">f</span> <span class="n">config</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p>For example, to upgrade to v0.6, enter and substituting <code class="docutils literal notranslate"><span class="pre">&lt;YOUR-HELM-RELEASE-NAME&gt;</span></code> and version v0.6:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">helm</span> <span class="n">upgrade</span> <span class="o">&lt;</span><span class="n">YOUR</span><span class="o">-</span><span class="n">HELM</span><span class="o">-</span><span class="n">RELEASE</span><span class="o">-</span><span class="n">NAME</span><span class="o">&gt;</span> <span class="n">jupyterhub</span><span class="o">/</span><span class="n">jupyterhub</span> <span class="o">--</span><span class="n">version</span><span class="o">=</span><span class="n">v0</span><span class="o">.</span><span class="mi">6</span> <span class="o">-</span><span class="n">f</span> <span class="n">config</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</div>
<div class="section" id="database">
<span id="database"></span><h3>Database<a class="headerlink" href="#database" title="Permalink to this headline">¶</a></h3>
<p>This release contains a major JupyterHub version bump (from 0.7.2 to 0.8). If
you are using the default database provider (SQLite), then the required db upgrades
will be performed automatically when you do a <code class="docutils literal notranslate"><span class="pre">helm</span> <span class="pre">upgrade</span></code>.</p>
<p><strong>Default (SQLite)</strong>: The database upgrade will be performed automatically when you
<a class="reference external" href="#upgrade-command">perform the upgrade</a></p>
<p><strong>MySQL / PostgreSQL</strong>: You will execute the following steps, which includes a manual update of your database:</p>
<ol>
<li><p class="first">Make a full backup of your database, just in case things go bad.</p>
</li>
<li><p class="first">Make sure that the database user used by JupyterHub to connect to your database
can perform schema migrations like adding new tables, altering tables, etc.</p>
</li>
<li><p class="first">In your <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code>, add the following config:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">hub</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">db</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">upgrade</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
</li>
<li><p class="first">Do a <a class="reference external" href="#upgrade-command"><code class="docutils literal notranslate"><span class="pre">helm</span> <span class="pre">upgrade</span></code></a>. This should perform the database upgrade needed.</p>
</li>
<li><p class="first">Remove the lines added in step 3, and do another <a class="reference external" href="#upgrade-command"><code class="docutils literal notranslate"><span class="pre">helm</span> <span class="pre">upgrade</span></code></a>.</p>
</li>
</ol>
</div>
<div class="section" id="role-based-access-control">
<span id="role-based-access-control"></span><h3><a class="reference external" href="http://zero-to-jupyterhub.readthedocs.io/en/latest/security.html#role-based-access-control-rbac">Role based access control</a><a class="headerlink" href="#role-based-access-control" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://kubernetes.io/docs/admin/authorization/rbac/">RBAC</a> is the user security model
in Kubernetes that gives applications only as much access they need to the kubernetes
API and not more. Prior to this, applications were all running with the equivalent
of root on your Kubernetes cluster. This release adds appropriate roles for the
various components of JupyterHub, for much better ability to secure clusters.</p>
<p>RBAC is turned on by default. But, if your cluster is older than 1.8, or you have RBAC
enforcement turned off, you might want to explicitly disable it. You can do so by adding
the following snippet to your <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">rbac</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">enabled</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</div>
<p>This is especially true if you get an error like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span><span class="p">:</span> <span class="n">the</span> <span class="n">server</span> <span class="n">rejected</span> <span class="n">our</span> <span class="n">request</span> <span class="k">for</span> <span class="n">an</span> <span class="n">unknown</span> <span class="n">reason</span> <span class="p">(</span><span class="n">get</span> <span class="n">clusterrolebindings</span><span class="o">.</span><span class="n">rbac</span><span class="o">.</span><span class="n">authorization</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span><span class="p">)</span>
</pre></div>
</div>
<p>when doing the upgrade!</p>
</div>
<div class="section" id="custom-docker-images-jupyterhub-version-match">
<span id="custom-docker-images-jupyterhub-version-match"></span><h3>Custom Docker Images: JupyterHub version match<a class="headerlink" href="#custom-docker-images-jupyterhub-version-match" title="Permalink to this headline">¶</a></h3>
<p>If you are using a custom built image, make sure that the version of the
JupyterHub package installed in it is now 0.8.1. It needs to be 0.8.1 for it to work with
v0.6 of the helm chart.</p>
<p>For example, if you are using <code class="docutils literal notranslate"><span class="pre">pip</span></code> to install JupyterHub in your custom Docker Image,
you would use:</p>
<div class="highlight-Dockerfile notranslate"><div class="highlight"><pre><span></span><span class="k">RUN</span> pip install --no-cache-dir <span class="nv">jupyterhub</span><span class="o">==</span><span class="m">0</span>.8.1
</pre></div>
</div>
</div>
</div>
<div class="section" id="troubleshooting">
<span id="troubleshooting"></span><h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<p>If the upgrade is failing on a test system or a system that does not serve users, you can try
deleting the helm chart using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">helm</span> <span class="n">delete</span> <span class="o">&lt;</span><span class="n">YOUR</span><span class="o">-</span><span class="n">HELM</span><span class="o">-</span><span class="n">RELEASE</span><span class="o">-</span><span class="n">NAME</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">purge</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">helm</span> <span class="pre">list</span></code> may be used to find &lt;YOUR-HELM-RELEASE-NAME&gt;.</p>
</div>
</div>


  <div class='prev-next-bottom'>
    
     <a class='left-prev' href="security.html" title="previous chapter">Security</a>
     <a class='right-next' href="troubleshooting.html" title="next chapter">FAQ</a>
  <div style='clear:both;'></div>

  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="index.html">Zero to JupyterHub with Kubernetes</a></h1>



<p class="blurb">A tutorial to help install and manage JupyterHub with Kubernetes</p>









<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<h3>Table of Contents</h3>
<p class="caption"><span class="caption-text">Step Zero: your Kubernetes cluster</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="create-k8s-cluster.html">Creating a Kubernetes Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="google/step-zero-gcp.html">Step Zero: Kubernetes on Google Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="microsoft/step-zero-azure.html">Step Zero: Kubernetes on Microsoft Azure Container Service (AKS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="amazon/step-zero-aws.html">Step Zero: Kubernetes on Amazon Web Services (AWS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="redhat/step-zero-openshift.html">JupyterHub on Red Hat OpenShift</a></li>
</ul>
<p class="caption"><span class="caption-text">Creating your JupyterHub</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting started with JupyterHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup-helm.html">Setting up Helm</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup-jupyterhub.html">Setting up JupyterHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="turn-off.html">Turning Off JupyterHub and Computational Resources</a></li>
</ul>
<p class="caption"><span class="caption-text">Customization Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="extending-jupyterhub.html">Extending your JupyterHub setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-environment.html">Customizing the User Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-resources.html">User Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-storage.html">User storage in JupyterHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-management.html">User Management</a></li>
</ul>
<p class="caption"><span class="caption-text">Administrator Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="architecture.html">The JupyterHub Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="debug.html">Debugging Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="optimization.html">Speed and Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Upgrading your JupyterHub Kubernetes deployment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#major-helm-chart-upgrades">Major helm-chart upgrades</a></li>
<li class="toctree-l2"><a class="reference internal" href="#subtopics">Subtopics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="cost.html">Appendix: Projecting deployment costs</a></li>
</ul>
<p class="caption"><span class="caption-text">Resources from the community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="additional-resources.html">Community-authored documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="users-list.html">Zero to JupyterHub Gallery of Deployments</a></li>
<li class="toctree-l1"><a class="reference internal" href="tips.html">Tips and command snippets</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Helm Chart Configuration Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference-docs.html">Official JupyterHub and Project Jupyter Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Tools used in a JupyterHub Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="http://github.com/jupyterhub/zero-to-jupyterhub-k8s">GitHub Repo</a></li>
    
    <li class="toctree-l1"><a href="http://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues">Issue Tracker</a></li>
    
</ul>

<div class="relations">
<h3>Navigation</h3>
<ul>
  <li><a href="index.html">Documentation Home</a><ul>
  <li><a href="security.html" title="Previous">Previous topic</a></li>
  <li><a href="troubleshooting.html" title="Next">Next topic</a></li>
  </ul>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/upgrading.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Project Jupyter team.
      
      |
      <a href="_sources/upgrading.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>