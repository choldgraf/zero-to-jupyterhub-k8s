
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Upgrading The helm chart &#8212; Zero to JupyterHub with Kubernetes 0.4 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Advanced Topics" href="advanced.html" />
    <link rel="prev" title="Troubleshooting" href="troubleshooting.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class='prev-next-top'>
    
     <a class='left-prev' href="troubleshooting.html" title="previous chapter">Previous</a>
     <a class='right-next' href="advanced.html" title="next chapter">Next</a>
  <div style='clear:both;'></div>

  </div>

  
  <div class="section" id="upgrading-the-helm-chart">
<span id="upgrading-the-helm-chart"></span><h1>Upgrading The helm chart<a class="headerlink" href="#upgrading-the-helm-chart" title="Permalink to this headline">¶</a></h1>
<div class="section" id="general-upgrade-advice">
<span id="general-upgrade-advice"></span><h2>General upgrade advice<a class="headerlink" href="#general-upgrade-advice" title="Permalink to this headline">¶</a></h2>
<p>In general, it should be safe to upgrade a minor revision of the chart to
receive bugfixes and improvements. A major chart upgrade (e.g. v0.4 to v0.5)
can be more challenging, but is possible. We still recommend a full fresh
installation if you can, but recognize it is not possible all the time. We've
provided and tested the following upgrade instructions. If you are planning an
upgrade of a critical major installation, we recommend you test it out on a
staging cluster first before applying it to production. Feel free to reach out
to us on <a class="reference external" href="http://gitter.im/jupyterhub/jupyterhub">gitter</a> or the <a class="reference external" href="https://groups.google.com/forum/#!forum/jupyter">mailing
list</a> for upgrade help!</p>
<p>General helm-chart upgrade considerations:</p>
<ol class="simple">
<li>Always backup your database!</li>
<li>Review incompatible changes for your upgrade (most should be on this page)
and update your configuration accordingly.</li>
<li>For major upgrades, user servers may need be stopped prior to the upgrade,
or restarted after it.</li>
</ol>
</div>
<div class="section" id="v0-4-to-v0-5">
<span id="v0-4-to-v0-5"></span><h2>v0.4 to v0.5<a class="headerlink" href="#v0-4-to-v0-5" title="Permalink to this headline">¶</a></h2>
<p>Release 0.5 contains a major JupyterHub version bump (from 0.7.2 to 0.8).
Since it is a major upgrade of JupyterHub that changes how authentication is
implemented, user servers must be stopped during the upgrade.
The database schema has also changed, so a database upgrade must be performed.</p>
<div class="section" id="database-upgrade">
<span id="database-upgrade"></span><h3>Database upgrade<a class="headerlink" href="#database-upgrade" title="Permalink to this headline">¶</a></h3>
<p>This release contains a major JupyterHub version bump (from 0.7.2 to 0.8). If
you are using the default database provider (SQLite), then the required db upgrades
will be performed automatically when you do a <code class="docutils literal"><span class="pre">helm</span> <span class="pre">upgrade</span></code>.</p>
<p><strong>Default (SQLite)</strong>: The database upgrade will be performed automatically when you
<a class="reference external" href="#upgrade-command">perform the upgrade</a></p>
<p><strong>MySQL / PostgreSQL</strong>: You will execute the following steps, which includes a manual update of your database:</p>
<ol>
<li><p class="first">Make a full backup of your database, just in case things go bad.</p>
</li>
<li><p class="first">Make sure that the database user used by JupyterHub to connect to your database
can perform schema migrations like adding new tables, altering tables, etc.</p>
</li>
<li><p class="first">In your <code class="docutils literal"><span class="pre">config.yaml</span></code>, add the following config:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">hub</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">db</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">upgrade</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
</li>
<li><p class="first">Do a <a class="reference external" href="#upgrade-command"><code class="docutils literal"><span class="pre">helm</span> <span class="pre">upgrade</span></code></a>. This should perform the database upgrade needed.</p>
</li>
<li><p class="first">Remove the lines added in step 3, and do another <a class="reference external" href="#upgrade-command"><code class="docutils literal"><span class="pre">helm</span> <span class="pre">upgrade</span></code></a>.</p>
</li>
</ol>
</div>
<div class="section" id="role-based-access-control">
<span id="role-based-access-control"></span><h3><a class="reference external" href="http://zero-to-jupyterhub.readthedocs.io/en/latest/security.html#role-based-access-control-rbac">Role based access control</a><a class="headerlink" href="#role-based-access-control" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://kubernetes.io/docs/admin/authorization/rbac/">RBAC</a> is the user security model
in Kubernetes that gives applications only as much access they need to the kubernetes
API and not more. Prior to this, applications were all running with the equivalent
of root on your Kubernetes cluster. This release adds appropriate roles for the
various components of JupyterHub, for much better ability to secure clusters.</p>
<p>RBAC is turned on by default. But, if your cluster is older than 1.8, or you have RBAC
enforcement turned off, you might want to explicitly disable it. You can do so by adding
the following snippet to your <code class="docutils literal"><span class="pre">config.yaml</span></code>:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">rbac</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">enabled</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</div>
<p>This is especially true if you get an error like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Error</span><span class="p">:</span> <span class="n">the</span> <span class="n">server</span> <span class="n">rejected</span> <span class="n">our</span> <span class="n">request</span> <span class="k">for</span> <span class="n">an</span> <span class="n">unknown</span> <span class="n">reason</span> <span class="p">(</span><span class="n">get</span> <span class="n">clusterrolebindings</span><span class="o">.</span><span class="n">rbac</span><span class="o">.</span><span class="n">authorization</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span><span class="p">)</span>
</pre></div>
</div>
<p>when doing the upgrade!</p>
</div>
<div class="section" id="custom-docker-images-jupyterhub-version-match">
<span id="custom-docker-images-jupyterhub-version-match"></span><h3>Custom Docker Images: JupyterHub version match<a class="headerlink" href="#custom-docker-images-jupyterhub-version-match" title="Permalink to this headline">¶</a></h3>
<p>If you are using a custom built image, make sure that the version of the
JupyterHub package installed in it is now 0.8. It needs to be version 0.7.2 for
it to work with v0.4 of the helm chart, and needs to be 0.8 for it to work with
v0.5 of the helm chart.</p>
<p>For example, if you are using pip to install JupyterHub in your custom Docker Image,
you would use:</p>
<div class="highlight-Dockerfile"><div class="highlight"><pre><span></span><span class="k">RUN</span> pip install --no-cache-dir <span class="nv">jupyterhub</span><span class="o">==</span><span class="m">0</span>.8.*
</pre></div>
</div>
</div>
<div class="section" id="ingress-config-incompatibilities">
<span id="ingress-config-incompatibilities"></span><h3>Ingress config incompatibilities<a class="headerlink" href="#ingress-config-incompatibilities" title="Permalink to this headline">¶</a></h3>
<p>We've made HTTPS <a class="reference external" href="http://zero-to-jupyterhub.readthedocs.io/en/latest/extending-jupyterhub.html#setting-up-https">much easier to set up</a>,
with automated certificates from <a class="reference external" href="https://letsencrypt.org/">Let's Encrypt</a>.
However, this means that some of the keys used to set up your own ingress has
changed.</p>
<p>If you were using config under <code class="docutils literal"><span class="pre">ingress</span></code> purely to get HTTPS, we recommend
that you delete your entire config section under <code class="docutils literal"><span class="pre">ingress</span></code> &amp; instead follow
the new <a class="reference external" href="http://zero-to-jupyterhub.readthedocs.io/en/latest/extending-jupyterhub.html#setting-up-https">docs</a>
on getting HTTPS set up. It's much easier &amp; a lot less error prone than the method recommended on 0.4.</p>
<p>If you were using config under <code class="docutils literal"><span class="pre">ingress</span></code> for other reasons, you may continue
to do so. The keys under <code class="docutils literal"><span class="pre">ingress</span></code> have changed, and are now much more in line
with how many other projects use <code class="docutils literal"><span class="pre">ingress</span></code> in the <a class="reference external" href="https://github.com/kubernetes/charts/">official charts repo</a>.
See <a class="reference external" href="http://zero-to-jupyterhub.readthedocs.io/en/latest/advanced.html#ingress">our ingress documentation</a>
for more details on how to set up ingress properly. This is the most likely issue if
you are getting an error like the following when upgrading:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>Ingress.extensions &quot;jupyterhub&quot; is invalid: spec: Invalid value: []extensions.IngressRule(nil): either `backend` or `rules` must be specified
</pre></div>
</div>
</div>
<div class="section" id="admin-config-incompatibility">
<span id="admin-config-incompatibility"></span><h3>Admin config incompatibility<a class="headerlink" href="#admin-config-incompatibility" title="Permalink to this headline">¶</a></h3>
<p>If you had used the <code class="docutils literal"><span class="pre">admin</span></code> config section before, you now need to move it under
<code class="docutils literal"><span class="pre">auth</span></code>. So if you had config like:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">admin</span><span class="p p-Indicator">:</span>
   <span class="l l-Scalar l-Scalar-Plain">access</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
   <span class="l l-Scalar l-Scalar-Plain">users</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">yuvipanda</span>
</pre></div>
</div>
<p>it should now be:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">auth</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">admin</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">access</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="l l-Scalar l-Scalar-Plain">users</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">yuvipanda</span>
</pre></div>
</div>
</div>
<div class="section" id="upgrade-command">
<span id="upgrade-command"></span><h3>Upgrade command<a class="headerlink" href="#upgrade-command" title="Permalink to this headline">¶</a></h3>
<p>After modifying your config.yaml file to match, you can run the actual upgrade with
the following helm command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">helm</span> <span class="n">upgrade</span> <span class="o">&lt;</span><span class="n">YOUR</span><span class="o">-</span><span class="n">RELEASE</span><span class="o">-</span><span class="n">NAME</span><span class="o">&gt;</span> <span class="n">jupyterhub</span><span class="o">/</span><span class="n">jupyterhub</span> <span class="o">--</span><span class="n">version</span><span class="o">=</span><span class="n">v0</span><span class="o">.</span><span class="mi">5</span> <span class="o">-</span><span class="n">f</span> <span class="n">config</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p>This should perform the upgrade! If you have forgotten your release name, you can find
out with <code class="docutils literal"><span class="pre">helm</span> <span class="pre">list</span></code>. Make sure to test the upgrade on a staging environment
before doing the upgrade!</p>
</div>
</div>
</div>


  <div class='prev-next-bottom'>
    
     <a class='left-prev' href="troubleshooting.html" title="previous chapter">Troubleshooting</a>
     <a class='right-next' href="advanced.html" title="next chapter">Advanced Topics</a>
  <div style='clear:both;'></div>

  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="index.html">Zero to JupyterHub with Kubernetes</a></h1>



<p class="blurb">A tutorial to help install and manage JupyterHub with Kubernetes</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=jupyterhub&repo=zero-to-jupyterhub-k8s&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






<h3>Table of Contents</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting started with JupyterHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="create-k8s-cluster.html">Creating a Kubernetes Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup-helm.html">Setting up Helm</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup-jupyterhub.html">Setting up JupyterHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="turn-off.html">Turning Off JupyterHub and Computational Resources</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="extending-jupyterhub.html">Extending your JupyterHub setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-environment.html">Customizing the User Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-resources.html">User Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-management.html">User Management</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="debug.html">Debugging Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="cost.html">Estimating costs</a></li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Upgrading The helm chart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general-upgrade-advice">General upgrade advice</a></li>
<li class="toctree-l2"><a class="reference internal" href="#v0-4-to-v0-5">v0.4 to v0.5</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Advanced Topics</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Helm Chart Configuration Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Tools used in a JupyterHub Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="additional-resources.html">Additional resources</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="http://github.com/jupyterhub/zero-to-jupyterhub-k8s">GitHub Repo</a></li>
    
    <li class="toctree-l1"><a href="http://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues">Issue Tracker</a></li>
    
</ul>

<div class="relations">
<h3>Navigation</h3>
<ul>
  <li><a href="index.html">Documentation Home</a><ul>
  <li><a href="troubleshooting.html" title="Previous">Previous topic</a></li>
  <li><a href="advanced.html" title="Next">Next topic</a></li>
  </ul>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/upgrading.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Project Jupyter team.
      
      |
      <a href="_sources/upgrading.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>